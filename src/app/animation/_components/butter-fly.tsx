"use client";
import { useEffect, useRef } from "react";

declare global {
  interface Window {
    MotionPathPlugin?: any;
  }
}

export const ButterflyBackground = ({
  className = "",
}: {
  className?: string;
}) => {
  const containerRef = useRef<HTMLDivElement | null>(null);

  useEffect(() => {
    if (!containerRef.current) return;

    // Store reference to the container to use in cleanup
    const container = containerRef.current;

    // Import GSAP from CDN if not already loaded
    const loadGSAP = async () => {
      if (!window.gsap) {
        await new Promise<void>((resolve) => {
          const script = document.createElement("script");
          script.src =
            "https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js";
          script.onload = () => resolve();
          document.head.appendChild(script);
        });
      }

      if (!window.MotionPathPlugin) {
        await new Promise<void>((resolve) => {
          const script = document.createElement("script");
          script.src =
            "https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/MotionPathPlugin.min.js";
          script.onload = () => resolve();
          document.head.appendChild(script);
        });
      }

      if (!window.gsap || !window.MotionPathPlugin || !container) {
        return;
      }

      const gsap = window.gsap;
      gsap.registerPlugin(window.MotionPathPlugin);

      const butterfly = container.querySelector("#butterfly");
      if (!butterfly) return;

      // Clear any existing animations
      gsap.killTweensOf(butterfly);

      // Create the path animation
      gsap.to(butterfly, {
        motionPath: {
          path: "#motionPath",
          align: "#motionPath",
          autoRotate: true,
          alignOrigin: [0.5, 0.5],
        },
        ease: "none",
        duration: 12,
        repeat: -1,
      });

      // Wing flapping animation
      const wings = butterfly.querySelectorAll("#leftWing");
      gsap.to(wings, {
        scaleY: 0.8,
        transformOrigin: "center center",
        yoyo: true,
        repeat: -1,
        duration: 0.2,
        stagger: 0.1,
      });
      const wingsRight = butterfly.querySelectorAll("#rightWing");
      gsap.to(wingsRight, {
        scaleY: 0.8,
        transformOrigin: "center center",
        yoyo: true,
        repeat: -1,
        duration: 0.2,
        stagger: 0.1,
      });
    };

    loadGSAP();

    // Cleanup function
    return () => {
      if (window.gsap) {
        const butterfly = container.querySelector("#butterfly");
        if (butterfly) {
          window.gsap.killTweensOf(butterfly);
        }
      }
    };
  }, []);

  return (
    <div
      ref={containerRef}
      className={`pointer-events-none fixed inset-0 z-5 ${className}`}
      aria-hidden="true"
    >
      <svg
        className="h-full w-full"
        viewBox="0 0 2032 385"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        {/* Path for butterfly to follow */}
        <path
          id="motionPath"
          d="M3.5 185.5C339.5 463.5 643.5 301.333 753.5 185.5C856.333 45.3333 1125.2 -148.7 1378 196.5C1630.8 541.7 1867.33 325.333 1954 174L2029 92"
          stroke="rgba(0, 0, 0, 0.7)"
          strokeWidth="3"
          strokeLinecap="round"
          strokeDasharray="27 25"
        />

        {/* Butterfly with gradient - positioned at the start of the path */}
        <g
          id="butterfly"
          style={{
            transformBox: "fill-box",
            transformOrigin: "center",
          }}
        >
          <g filter="url(#filter0_d_24_26)">
            <path
              d="M99.0236 75.8885C98.6107 75.6132 98.3297 75.2362 98.2337 74.871C98.2627 73.9935 98.7789 73.3572 99.6241 73.1857C105.161 72.1784 112.348 70.2891 118.109 67.6938C120.986 66.3972 123.553 64.9046 125.38 63.225C127.195 61.5572 128.376 59.611 128.241 57.4231C128.252 56.5549 128.962 55.6561 129.818 55.4451C130.865 55.4767 131.551 56.1557 131.748 57.0477C131.957 60.2237 130.446 62.9704 127.861 65.357C125.255 67.7634 121.62 69.7388 117.796 71.3181C110.153 74.4741 101.967 75.9631 100.369 76.2089L100.353 76.2115L100.336 76.2148C99.9501 76.2919 99.4624 76.181 99.0236 75.8885Z"
              stroke="black"

            />
          </g>
          <path
            d="M100.401 77.9434L100.401 77.9435L100.412 77.9452C102.139 78.1919 110.347 79.6843 117.984 82.851C121.804 84.435 125.447 86.4238 128.065 88.8585C130.677 91.288 132.229 94.12 131.994 97.4201L131.992 97.4379V97.4557C131.992 98.6263 131.04 99.416 129.823 99.2133L129.783 99.2065H129.741C128.571 99.2065 127.781 98.2546 127.984 97.0378L127.988 97.0141L127.989 96.9901C128.13 94.9556 127.001 93.0987 125.21 91.4637C123.412 89.8233 120.874 88.3363 118.008 87.0293C112.271 84.4129 105.102 82.4648 99.5725 81.4594L99.4785 81.4423L99.3849 81.4611C98.9249 81.5531 98.6038 81.4175 98.3824 81.176C98.1435 80.9154 97.9824 80.4849 97.9824 79.9511V79.9496V79.9482V79.9467V79.9453V79.9438V79.9424V79.941V79.9396V79.9381V79.9367V79.9353V79.9339V79.9325V79.9311V79.9298V79.9284V79.927V79.9256V79.9243V79.9229V79.9216V79.9202V79.9189V79.9175V79.9162V79.9149V79.9136V79.9122V79.9109V79.9096V79.9083V79.907V79.9057V79.9045V79.9032V79.9019V79.9006V79.8994V79.8981V79.8968V79.8956V79.8944V79.8931V79.8919V79.8906V79.8894V79.8882V79.887V79.8858V79.8845V79.8833V79.8821V79.881V79.8798V79.8786V79.8774V79.8762V79.875V79.8739V79.8727V79.8716V79.8704V79.8692V79.8681V79.867V79.8658V79.8647V79.8636V79.8624V79.8613V79.8602V79.8591V79.858V79.8569V79.8558V79.8547V79.8536V79.8525V79.8514V79.8503V79.8493V79.8482V79.8471V79.846V79.845V79.8439V79.8429V79.8418V79.8408V79.8397V79.8387V79.8377V79.8366V79.8356V79.8346V79.8336V79.8325V79.8315V79.8305V79.8295V79.8285V79.8275V79.8265V79.8255V79.8245V79.8236V79.8226V79.8216V79.8206V79.8196V79.8187V79.8177V79.8167V79.8158V79.8148V79.8139V79.8129V79.812V79.811V79.8101V79.8092V79.8082V79.8073V79.8064V79.8054V79.8045V79.8036V79.8027V79.8018V79.8009V79.7999V79.799V79.7981V79.7972V79.7963V79.7954V79.7946V79.7937V79.7928V79.7919V79.791V79.7901V79.7893V79.7884V79.7875V79.7866V79.7858V79.7849V79.7841V79.7832V79.7823V79.7815V79.7806V79.7798V79.7789V79.7781V79.7772V79.7764V79.7756V79.7747V79.7739V79.7731V79.7722V79.7714V79.7706V79.7698V79.7689V79.7681V79.7673V79.7665V79.7657V79.7649V79.764V79.7632V79.7624V79.7616V79.7608V79.76V79.7592V79.7584V79.7576V79.7568V79.756V79.7552V79.7545V79.7537V79.7529V79.7521V79.7513V79.7505V79.7498V79.749V79.7482V79.7474V79.7466V79.7459V79.7451V79.7443V79.7436V79.7428V79.742V79.7413V79.7405V79.7397V79.739V79.7382V79.7374V79.7367V79.7359V79.7352V79.7344V79.7337V79.7329V79.7322V79.7314V79.7307V79.7299V79.7292V79.7284V79.7277V79.7269V79.7262V79.7254V79.7247V79.7239V79.7232V79.7224V79.7217V79.721V79.7202V79.7195V79.7187V79.718V79.7173V79.7165V79.7158V79.7151V79.7143V79.7136V79.7128V79.7121V79.7114V79.7106V79.7099V79.7092V79.7084V79.7077V79.707V79.7062V79.7055V79.7048V79.704V79.7033V79.7026V79.7018V79.7011V79.7004V79.6996V79.6989V79.6982V79.6974V79.6967V79.696V79.6952V79.6945V79.6938V79.693V79.6923V79.6916V79.6908V79.6901V79.6894V79.6886V79.6879V79.6872V79.6864V79.6857V79.6849V79.6842V79.6835V79.6827V79.682V79.6812V79.6805V79.6798V79.679V79.6783V79.6775V79.6768V79.676V79.6753V79.6745V79.6738V79.6731V79.6723V79.6716V79.6708V79.67V79.6693V79.6685V79.6678V79.667V79.6663V79.6655V79.6648V79.664V79.6632V79.6625V79.6617V79.6609V79.6602V79.6594V79.6586V79.6579V79.6571V79.6563V79.6556V79.6548V79.654V79.6532V79.6524V79.6517V79.6509V79.6501V79.6493V79.6485V79.6477V79.6469V79.6461V79.6454V79.6446V79.6438V79.643V79.6422V79.6414V79.6406V79.6398V79.6389V79.6381V79.6373V79.6365V79.6357V79.6349V79.6341V79.6332V79.6324V79.6316V79.6308V79.6299V79.6291V79.6283V79.6274V79.6266V79.6258V79.6249V79.6241V79.6232V79.6224V79.6215V79.6207V79.6198V79.619V79.6181V79.6172V79.6164V79.6155V79.6146V79.6138V79.6129V79.612V79.6111V79.6103V79.6094V79.6085V79.6076V79.6067V79.6058V79.6049V79.604V79.6031V79.6022V79.6013V79.6004V79.5995V79.5985V79.5976V79.5967V79.5958V79.5948V79.5939V79.593V79.592V79.5911V79.5901V79.5892V79.5882V79.5873V79.5863V79.5854V79.5844V79.5834V79.5825V79.5815V79.5805V79.5795V79.5786V79.5776V79.5766V79.5756V79.5746V79.5736V79.5726V79.5716V79.5706V79.5696V79.5685V79.5675V79.5665V79.5655V79.5644V79.5634V79.5624V79.5613V79.5603V79.5592V79.5582V79.5571V79.556V79.555V79.5539V79.5528V79.5517V79.5507V79.5496V79.5485V79.5474V79.5463V79.5452V79.5441V79.543V79.5419V79.5407V79.5396V79.5385V79.5374V79.5362V79.5351V79.5339V79.5328V79.5316V79.5305V79.5293V79.5282V79.527V79.5258V79.5246V79.5235V79.5223V79.5211V79.5199V79.5187V79.5175V79.5163V79.5151V79.5138V79.5126V79.5114V79.5101V79.5089V79.5077V79.5064V79.5052V79.5039V79.5033C98.2025 78.5288 99.1951 77.7424 100.401 77.9434Z"
            stroke="black"
          />
          {/* left wings */}
          <g filter="url(#filter2_d_24_26)" id="leftWing">
            <path
              d="M139.744 10.6818C135.493 48.1921 89.9803 64.9467 89.9803 64.9467H69.9746V22.4352C69.9746 6.18053 84.9787 7.43097 84.9787 7.43097H119.989C124.74 2.67976 129.991 2.17953 133.742 2.67976C137.493 3.17999 139.994 6.93074 139.744 10.6818Z"
              fill="#FFF7B9"
            />
            <path
              d="M90.1256 63.8191C89.9881 63.8733 89.8783 63.9158 89.7977 63.9467H70.9746V22.4352C70.9746 18.5295 71.8741 15.7569 73.158 13.7776C74.4425 11.7972 76.156 10.5429 77.8933 9.74665C79.638 8.94699 81.3971 8.61457 82.7311 8.48488C83.3954 8.4203 83.9468 8.4067 84.3281 8.40897C84.5185 8.41011 84.6659 8.4152 84.7631 8.41978C84.8116 8.42208 84.8476 8.42424 84.87 8.42572L84.8933 8.42735L84.8957 8.42752L84.8966 8.42759L84.8971 8.42763L84.8972 8.42764L84.9371 8.43097H84.9787H119.989H120.403L120.696 8.13808C125.17 3.6634 130.079 3.20012 133.61 3.67098L133.742 2.67976L133.61 3.67098C136.728 4.08676 138.959 7.26365 138.748 10.5928C136.659 28.9379 124.478 42.2776 112.67 51.0789C106.775 55.4731 101.007 58.7097 96.7124 60.8475C94.566 61.9159 92.7901 62.7085 91.5537 63.2329C90.9356 63.4951 90.4525 63.6902 90.1256 63.8191Z"
              stroke="black"
            />
          </g>
          <g filter="url(#filter3_d_24_26)" id="leftWing">
            <path
              d="M69.9749 64.9471L62.4728 29.9372C62.4728 29.9372 57.4713 12.9324 39.9665 29.9372L19.9612 24.9357C19.9612 24.9357 13.4593 23.4353 10.9587 29.9372C9.45827 33.9381 10.4585 38.4394 13.2093 41.6905C16.4601 45.6916 21.9618 51.4433 30.214 55.4442C33.7152 57.1947 52.4705 64.9471 52.4705 64.9471H69.9749Z"
              fill="#F9DAFF"
            />
            <path
              d="M39.7239 30.9074L40.264 31.0424L40.6633 30.6545C44.9747 26.4662 48.4256 24.464 51.1304 23.7282C53.7942 23.0037 55.7749 23.4941 57.2581 24.411C58.7776 25.3503 59.8468 26.7845 60.5449 28.0338C60.8904 28.6521 61.1359 29.2087 61.294 29.6079C61.3728 29.8071 61.4295 29.9659 61.4656 30.0721C61.4835 30.1248 61.4963 30.1645 61.5042 30.1896C61.5043 30.1898 61.5043 30.19 61.5044 30.1901L68.7379 63.9471H52.6692L52.6414 63.9356L52.0406 63.6867C51.5213 63.4715 50.7754 63.162 49.8693 62.7851C48.0571 62.0313 45.6046 61.0081 43.043 59.9303C37.8986 57.7659 32.3746 55.4064 30.6612 54.5497L30.6613 54.5497L30.6503 54.5444C22.5785 50.631 17.1858 44.9989 13.9854 41.0599L13.9792 41.0522L13.9727 41.0446C11.4305 38.0401 10.536 33.9167 11.8935 30.2923C13.0058 27.4039 14.9528 26.3497 16.6179 25.9737C17.4718 25.7809 18.2643 25.766 18.846 25.801C19.1353 25.8185 19.3677 25.8479 19.5237 25.8721C19.6015 25.8842 19.6598 25.8949 19.6962 25.9019C19.7133 25.9053 19.7255 25.9078 19.7325 25.9093L39.7239 30.9074Z"
              stroke="black"
            />
          </g>
          {/* right wings */}
          <g filter="url(#filter4_d_24_26)" id="leftWing">
            <path
              d="M139.744 139.218C135.493 101.957 89.9803 84.9524 89.9803 84.9524H69.9746V127.464C69.9746 143.719 84.9787 142.468 84.9787 142.468H119.989C124.74 147.22 129.991 147.72 133.742 147.22C137.493 146.72 139.994 142.969 139.744 139.218Z"
              fill="#FFF7B9"
            />
            <path
              d="M84.9787 141.468H84.9371L84.8972 141.472L84.8971 141.472L84.8966 141.472L84.8957 141.472L84.8933 141.472L84.87 141.474C84.8476 141.475 84.8116 141.477 84.7631 141.48C84.6659 141.484 84.5185 141.489 84.3281 141.49C83.9468 141.493 83.3954 141.479 82.7311 141.414C81.3971 141.285 79.638 140.952 77.8933 140.153C76.156 139.356 74.4425 138.102 73.158 136.122C71.8741 134.143 70.9746 131.37 70.9746 127.464V85.9524H89.7952C89.8757 85.9837 89.9849 86.0265 90.1213 86.081C90.4483 86.2117 90.9315 86.4094 91.5498 86.6748C92.7864 87.2056 94.5625 88.007 96.7092 89.0852C101.005 91.2426 106.773 94.5028 112.669 98.9131C124.479 107.747 136.66 121.087 138.748 139.307C138.959 142.636 136.728 145.813 133.61 146.228L133.61 146.228C130.079 146.699 125.17 146.236 120.696 141.761L120.403 141.468H119.989H84.9787Z"
              stroke="black"
            />
          </g>
          <g filter="url(#filter5_d_24_26)" id="leftWing">
            <path
              d="M69.9749 84.9524L62.4729 119.962C62.4729 119.962 57.4713 136.967 39.9665 119.962L19.961 124.964C19.961 124.964 13.459 126.464 10.9584 119.962C9.45803 115.961 10.4582 111.46 13.2091 108.209C16.4599 104.208 21.9616 98.4561 30.2139 94.4551C33.7149 92.7048 52.4701 84.9524 52.4701 84.9524H69.9749Z"
              fill="#F9DAFF"
            />
            <path
              d="M40.6633 119.245L40.264 118.857L39.724 118.992L19.7336 123.99C19.7332 123.99 19.7328 123.99 19.7323 123.99C19.7252 123.991 19.7131 123.994 19.696 123.997C19.6597 124.004 19.6013 124.015 19.5235 124.027C19.3676 124.051 19.1351 124.081 18.8459 124.098C18.2641 124.133 17.4716 124.118 16.6177 123.926C14.9526 123.55 13.0055 122.496 11.8933 119.607C10.5358 115.982 11.4303 111.859 13.9725 108.855L13.9789 108.847L13.9852 108.839C17.1855 104.901 22.5783 99.2685 30.6502 95.3549L30.6502 95.355L30.6611 95.3495C32.3743 94.493 37.8983 92.1335 43.0427 89.9691C45.6043 88.8914 48.0568 87.8682 49.869 87.1144C50.7751 86.7375 51.521 86.428 52.0403 86.2127L52.6411 85.9639L52.6688 85.9524H68.738L61.5044 119.709C61.5044 119.709 61.5043 119.71 61.5043 119.71C61.5003 119.722 61.4951 119.739 61.4887 119.758C61.4823 119.778 61.4746 119.801 61.4656 119.827C61.4295 119.934 61.3729 120.092 61.294 120.292C61.1359 120.691 60.8905 121.247 60.5449 121.866C59.8468 123.115 58.7777 124.549 57.2582 125.488C55.775 126.405 53.7942 126.896 51.1304 126.171C48.4256 125.435 44.9747 123.433 40.6633 119.245Z"
              stroke="black"
            />
          </g>

          {/* body */}
          <g filter="url(#filter6_d_24_26)">
            <path
              d="M69.975 84.9523C53.4703 84.9523 39.9666 80.451 39.9666 74.9496C39.9666 69.4481 53.4703 64.947 69.975 64.947C86.4795 64.947 99.9832 69.4481 99.9832 74.9496C99.9832 80.451 86.4795 84.9523 69.975 84.9523Z"
              fill="#FFE6B5"
            />
            <path
              d="M69.975 84.2023C61.7815 84.2023 54.363 83.0839 49.0187 81.3025C46.3426 80.4104 44.2277 79.3656 42.7974 78.2434C41.3575 77.1136 40.7166 75.9943 40.7166 74.9496C40.7166 73.9049 41.3575 72.7855 42.7974 71.6558C44.2277 70.5336 46.3426 69.4888 49.0187 68.5968C54.363 66.8154 61.7815 65.697 69.975 65.697C78.1684 65.697 85.5868 66.8154 90.9311 68.5968C93.6072 69.4888 95.7221 70.5336 97.1524 71.6558C98.5923 72.7855 99.2332 73.9049 99.2332 74.9496C99.2332 75.9943 98.5923 77.1136 97.1524 78.2434C95.7221 79.3656 93.6072 80.4104 90.9311 81.3025C85.5868 83.0839 78.1684 84.2023 69.975 84.2023Z"
              stroke="black"
            />
          </g>
        </g>
      </svg>
    </div>
  );
};
